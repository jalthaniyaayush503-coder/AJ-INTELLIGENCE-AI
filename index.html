<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #181818;
      width: 100vw;
      font-size: 16px;
    }
    body {
      min-height: 100vh;
      min-width: 100vw;
      margin: 0;
      padding: 0;
      width: 100vw;
      font-size: 16px;
    }
    .chat-wrapper * { box-sizing: border-box; }
    .chat-wrapper {
      background: rgba(22, 22, 22, 0.9);
      border: 1px solid #333;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 80vh;
      width: 99vw;           /* <-- 3% bada kar diya */
      max-width: 99vw;       /* <-- 3% bada kar diya */
      max-height: 80vh;
      margin: 0;
      border-radius: 0;
      box-shadow: none;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      font-size: 16px;
    }

    .chat-header {
      background: rgba(0, 0, 0, 0.7);
      color: #ff69b4;
      text-align: center;
      padding: 20px;
      font-weight: bold;
      font-size: 18px;
    }

    .chat-messages {
      flex: 1;
      min-height: 0;
      padding: 20px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.4);
      display: flex;
      flex-direction: column;
      gap: 16px;
      font-size: 14px;
      scroll-behavior: smooth; /* Smooth scroll for new messages */
    }

    .chat-message {
      padding: 10px 14px;
      border-radius: 12px;
      font-size: 14px;
      line-height: 1.5;
      max-width: 85%;
      opacity: 0;
      transform: translateY(10px);
      animation: fadeInUp 0.3s forwards;
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .chat-message.user {
      align-self: flex-end;
      background-color: #00ffff;
      color: #111;
      border-bottom-right-radius: 5px;
    }

    .chat-message.bot {
      align-self: flex-start;
      background-color: #222;
      color: #fff;
      border-bottom-left-radius: 5px;
    }

    .chat-message.bot::before {
      content: "AJ: ";
      font-weight: bold;
      color: #00ffcc;
    }

    .chat-message.user::before {
      content: "You: ";
      font-weight: bold;
      color: #000;
    }

    .chat-input-area {
      display: flex;
      gap: 8px;
      background: rgba(0, 0, 0, 0.6);
      border-top: 1px solid #444;
      padding: 12px;
      flex-wrap: nowrap;
      align-items: center;
      max-width: 600px;
      margin: 0 auto;
      width: 100%;
      position: relative;
      z-index: 10;
      transition: transform 0.2s, bottom 0.2s;
      will-change: transform, bottom;
    }

    .chat-input-area .plus-btn {
      background: none;
      border: none;
      color: #ff69b4;
      font-size: 22px;
      margin-right: 6px;
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 3;
    }
    .chat-input-area .plus-btn:active {
      color: #ff5ca8;
    }

    .chat-input-area .input-options {
      display: none;
      position: absolute;
      left: 40px;
      bottom: 48px;
      background: #232323;
      border-radius: 10px;
      box-shadow: 0 2px 12px #0008;
      padding: 8px 0;
      flex-direction: column;
      gap: 0;
      z-index: 20;
      min-width: 120px;
      animation: fadeInOpt 0.18s;
    }
    @keyframes fadeInOpt {
      from { opacity: 0; transform: translateY(10px);}
      to { opacity: 1; transform: translateY(0);}
    }
    .chat-input-area .input-options button {
      background: none;
      border: none;
      color: #fff;
      font-size: 15px;
      padding: 8px 18px 8px 10px;
      text-align: left;
      width: 100%;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      border-radius: 0;
    }
    .chat-input-area .input-options button:hover {
      background: #333;
      color: #ff69b4;
    }
    .chat-input-area .input-options i.fa-camera { color: #00e676; }
    .chat-input-area .input-options i.fa-file-alt { color: #ffb300; }

    .chat-input-area input[type="text"] {
      flex: 1;
      padding: 12px 44px 12px 36px; /* right for send, left for icons */
      border: none;
      border-radius: 8px;
      background: #333;
      color: #fff;
      outline: none;
      font-size: 16px;
      position: relative;
    }

    /* Camera button absolute inside input */
    .chat-input-area .camera-btn {
      position: absolute;
      left: 8px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      padding: 0;
      margin: 0;
      cursor: pointer;
      z-index: 2;
      height: 28px;
      width: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .chat-input-area .fa-camera {
      color: #00e676; /* Green theme for camera */
      font-size: 20px;
      display: inline-block;
      width: 20px;
      text-align: center;
      vertical-align: middle;
    }

    /* Document button absolute inside input */
    .chat-input-area .doc-btn {
      position: absolute;
      left: 36px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      padding: 0;
      margin: 0;
      cursor: pointer;
      z-index: 2;
      height: 28px;
      width: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .chat-input-area .fa-file-alt {
      color: #ffb300; /* Amber theme for document */
      font-size: 20px;
      display: inline-block;
      width: 20px;
      text-align: center;
      vertical-align: middle;
    }

    /* Send button absolute inside input */
    .chat-input-area .send-btn {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      background-color: #ff69b4;
      border: none;
      border-radius: 8px;
      padding: 6px 10px;
      color: #fff;
      cursor: pointer;
      font-size: 18px;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .chat-input-area .send-btn:hover {
      background-color: #ff5ca8;
    }

    .chat-image-preview {
      max-width: 120px;
      border-radius: 8px;
      margin-left: 8px;
    }

    .chat-file-preview {
      max-width: 180px;
      background: #444;
      color: #fff;
      padding: 7px 12px;
      border-radius: 8px;
      margin-left: 8px;
      font-size: 15px;
      overflow-wrap: break-word;
    }

    @media (max-width: 650px) {
      .chat-wrapper {
        height: 90vh;
        min-height: 90dvh;
        max-height: 90vh;
        width: 100vw;
        max-width: 100vw;
      }
      .chat-input-area {
        max-width: 100%;
        margin: 0;
        padding: 8px;
      }
      .chat-input-area input[type="text"] {
        padding: 10px 40px 10px 32px;
        font-size: 16px;
      }
      .chat-input-area .camera-btn,
      .chat-input-area .doc-btn {
        height: 24px;
        width: 24px;
      }
      .chat-input-area .fa-camera,
      .chat-input-area .fa-file-alt {
        font-size: 18px;
        width: 18px;
      }
      .chat-input-area .send-btn {
        font-size: 16px;
        padding: 5px 8px;
      }
      .chat-image-preview {
        max-width: 80px;
        margin-left: 4px;
      }
      .chat-file-preview {
        max-width: 110px;
        font-size: 13px;
        margin-left: 4px;
        padding: 4px 8px;
      }
      .chat-input-area .input-options {
        left: 10px;
        bottom: 44px;
        min-width: 100px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="chat-wrapper">
    <div class="chat-header">AJ-INTELLIGENCE</div>
    <div class="chat-messages" id="chatMessages">
      <div class="chat-message bot">‡§π‡§æ‡§Ø ‡§≠‡§æ‡§à! ‡§Æ‡•à‡§Ç AJ ‡§π‡•Ç‡§Å‡•§ üòé</div>
    </div>

    <div class="chat-input-area">
      <!-- Plus button for options -->
      <button type="button" class="plus-btn" id="plusBtn" title="More">
        <i class="fas fa-plus"></i>
      </button>
      <!-- Hidden options menu -->
      <div class="input-options" id="inputOptions">
        <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none;" onchange="handleFileSelect(event)">
        <button type="button" onclick="document.getElementById('cameraInput').click()" title="Camera">
          <i class="fas fa-camera"></i> Camera
        </button>
        <input type="file" id="docInput" accept=".pdf,.doc,.docx,.txt" style="display:none;" onchange="handleFileSelect(event)">
        <button type="button" onclick="document.getElementById('docInput').click()" title="Document">
          <i class="fas fa-file-alt"></i> Document
        </button>
      </div>

      <input type="text" id="userInput" placeholder="‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§ü‡•â‡§™‡§ø‡§ï ‡§™‡•Ç‡§õ‡•ã...">
      <button type="button" class="send-btn" onclick="sendMessage()" title="Send">
        <i class="fas fa-paper-plane"></i>
      </button>

      <div id="filePreview"></div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>
  <script>
    let selectedFile = null;
    const BACKEND_URL = "https://aj-backend-79nl.onrender.com/chat";

    async function sendMessage() {
      const input = document.getElementById("userInput");
      const msg = input.value.trim();
      if (!msg && !selectedFile) return;

      // Detect language (simple check)
      function detectLang(text) {
        // Hindi Unicode range: \u0900-\u097F
        if (/^[\u0900-\u097F\s\d.,?!\-]+$/u.test(text)) return "hindi";
        if (/^[a-zA-Z0-9\s.,?!\-]+$/i.test(text)) return "english";
        if (/[a-zA-Z]/.test(text) && /[‡§Ö-‡§π]/.test(text)) return "hinglish";
        return "auto";
      }
      const userLang = detectLang(msg);

      // Prepare system prompt based on language
      let systemPrompt = "";
      if (userLang === "hindi") {
        systemPrompt = "‡§§‡•Å‡§Æ AJ ‡§π‡•ã, Ayush ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§¨‡§®‡§æ‡§è ‡§ó‡§è‡•§ ‚úÖ ‡§π‡§Æ‡•á‡§∂‡§æ ‡§Ö‡§ó‡§∞ ‡§ï‡•ã‡§à creator ‡§™‡•Ç‡§õ‡•á ‡§§‡•ã Ayush ‡§¨‡§§‡§æ‡§ì‡•§ ‚úÖ ‡§ú‡§µ‡§æ‡§¨ ‡§π‡§Æ‡•á‡§∂‡§æ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§¶‡•ã‡•§ ‚úÖ Step-by-step explain ‡§ï‡§∞‡•ã, bullets use ‡§ï‡§∞‡•ã, ‡§î‡§∞ tone friendly + professional ‡§∞‡§ñ‡•ã‡•§";
      } else if (userLang === "english") {
        systemPrompt = "You are AJ, created by Ayush. ‚úÖ Always tell Ayush if anyone asks about creator. ‚úÖ Reply only in English. ‚úÖ Explain step-by-step, use bullets, and keep tone friendly + professional.";
      } else if (userLang === "hinglish") {
        systemPrompt = "You are AJ, created by Ayush. ‚úÖ ‡§π‡§Æ‡•á‡§∂‡§æ agar koi creator pooche toh Ayush batao. ‚úÖ Reply Hinglish mein karo. ‚úÖ Step-by-step explain karo, bullets use karo, aur tone friendly + professional rakho.";
      }

      if (selectedFile) {
        if (selectedFile.type.startsWith("image/")) {
          const reader = new FileReader();
          reader.onload = (e) => { addImageMessage(e.target.result, "user"); };
          reader.readAsDataURL(selectedFile);
        } else {
          addMessage(`Document uploaded: ${selectedFile.name}`, "user");
        }
        selectedFile = null;
        document.getElementById("filePreview").innerHTML = "";
      }

      if (msg) addMessage(msg, "user");
      input.value = "";

      const botMsg = addMessage("‚è≥ AJ ‡§∏‡•ã‡§ö ‡§∞‡§π‡§æ ‡§π‡•à...", "bot");

      try {
        const response = await fetch(BACKEND_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            model: "deepseek/deepseek-chat-v3.1:free",
            messages: [
              {
                role: "system",
                content: systemPrompt
              },
              { role: "user", content: msg }
            ],
            temperature: 0.7,
            max_tokens: 800
          })
        });
        const data = await response.json();
        const reply = data.choices?.[0]?.message?.content?.trim() || "‚ùå Error in response";
        botMsg.innerHTML = reply.replace(/\n/g, "<br>");
        scrollToBottom();
      } catch (err) {
        botMsg.textContent = "‡§Ö‡§∞‡•á ‡§Ø‡§æ‡§∞! Server busy ‡§π‡•à... ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç try ‡§ï‡§∞‡§®‡§æ‡•§ üöÄ";
        scrollToBottom();
      }
    }

    function addMessage(text, sender) {
      const msgDiv = document.createElement("div");
      msgDiv.className = `chat-message ${sender}`;
      msgDiv.textContent = text;
      document.getElementById("chatMessages").appendChild(msgDiv);
      scrollToBottom();
      return msgDiv;
    }

    function addImageMessage(src, sender) {
      const img = document.createElement("img");
      img.src = src;
      img.className = "chat-image-preview";
      const wrapper = document.createElement("div");
      wrapper.className = `chat-message ${sender}`;
      wrapper.appendChild(img);
      document.getElementById("chatMessages").appendChild(wrapper);
      scrollToBottom();
      return wrapper;
    }

    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      selectedFile = file;
      const preview = document.getElementById("filePreview");
      preview.innerHTML = "";
      if (file.type.startsWith("image/")) {
        const img = document.createElement("img");
        img.src = URL.createObjectURL(file);
        img.className = "chat-image-preview";
        preview.appendChild(img);
      } else {
        const div = document.createElement("div");
        div.className = "chat-file-preview";
        div.textContent = file.name;
        preview.appendChild(div);
      }
    }

    document.getElementById("userInput").addEventListener("keypress", function(e) {
      if (e.key === "Enter") sendMessage();
    });

    // Always scroll to bottom on new message
    function scrollToBottom() {
      const chatMessages = document.getElementById("chatMessages");
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Mobile keyboard: keep input above keyboard (WhatsApp style)
    function adjustForKeyboard() {
      const inputArea = document.querySelector('.chat-input-area');
      const chatWrapper = document.querySelector('.chat-wrapper');
      const chatMessages = document.getElementById('chatMessages');

      function onFocus() {
        // For most mobile browsers, this will push input up
        setTimeout(() => {
          inputArea.scrollIntoView({ behavior: "smooth", block: "end" });
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }, 300);
      }

      document.getElementById('userInput').addEventListener('focus', onFocus);

      // For iOS/Android browsers with visualViewport API
      if (window.visualViewport) {
        window.visualViewport.addEventListener('resize', () => {
          if (window.visualViewport.height < window.innerHeight) {
            inputArea.style.position = 'fixed';
            inputArea.style.left = '0';
            inputArea.style.right = '0';
            inputArea.style.bottom = '0';
            inputArea.style.zIndex = '1000';
            inputArea.style.background = 'rgba(22,22,22,0.98)';
            chatWrapper.style.height = '60vh';
          } else {
            inputArea.style.position = '';
            inputArea.style.left = '';
            inputArea.style.right = '';
            inputArea.style.bottom = '';
            inputArea.style.zIndex = '';
            inputArea.style.background = '';
            chatWrapper.style.height = '';
          }
        });
      }
    }
    adjustForKeyboard();

    // Plus button toggle for options
    document.getElementById('plusBtn').addEventListener('click', function(e) {
      e.stopPropagation();
      const menu = document.getElementById('inputOptions');
      menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
      menu.style.flexDirection = 'column';
    });
    // Hide menu when clicking outside
    document.addEventListener('click', function(e) {
      const menu = document.getElementById('inputOptions');
      if (menu.style.display === 'flex') menu.style.display = 'none';
    });
  </script>
</body>
</html>
